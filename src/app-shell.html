<link rel="import" href="../bower_components/polymer/polymer-element.html">

<link rel="import" href="app-state.html">
<link rel="import" href="controller-ui.html">
<link rel="import" href="app-data.html">
<link rel="import" href="controller-history.html">
<link rel="import" href="app-router.html">
<script src="js/tools.js"></script>
<script src="js/rectangle.js"></script>
<script src="js/matrix.js"></script>

<dom-module id="app-shell">
  <template>
    <style>
      :host { height: 100%; }
    </style>

    <app-state state="{{state}}"></app-state>
    <app-router default-url="unsaved"></app-router>
    <app-data id="data" state="[[state]]"
              user="[[state.persistent.user]]"
              sketch-id="[[state.session.route.segments.0]]"></app-data>

    <controller-ui id="ui" state="[[state]]"></controller-ui>
    
  </template>
  <script>
    class AppShell extends Polymer.Element {
      static get is() {
        return "app-shell";
      }

      static get properties() {
        return {
          state: Object
        }
      }

      connectedCallback() {
        super.connectedCallback();
        this.fire('app-connected');
      }

      _signIn() {
        this.$.data.signIn();
      }

      _signOut(e) {
        this.$.data.signOut();
      }

      fire(name, detail) {
        this.dispatchEvent(new CustomEvent(name, {
          composed: true,
          bubbles: true,
          detail: detail
        }))
      }
    }
    customElements.define(AppShell.is, AppShell);
  </script>
</dom-module>