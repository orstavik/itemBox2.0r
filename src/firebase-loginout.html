<dom-module id="firebase-loginout">
  <script>
    class FirebaseLoginout extends Polymer.Element {

      static get is() {
        return "firebase-loginout";
      }

      static get properties() {
        return {
          user: {
            type: Object,
            notify: true,
          },
          provider: {
            type: Object,
            value: function() {
              return new firebase.auth.GoogleAuthProvider();
            }
          }
        };
      }

      connectedCallback() {
        super.connectedCallback();
        firebase.auth().onAuthStateChanged(this.setUser.bind(this));
      }

      signIn() {
        firebase.auth().signInWithPopup(this.provider).catch(this._fire.bind(this, "system-error"));
      }

      signOut() {
        firebase.auth().signOut().catch(err => this._fire("system-error", err));
      }

      setUser(user) {
        this.set("user", user);
      }

      _fire(name, detail){
        this.dispatchEvent(new CustomEvent(name, {composed: true, bubbles: true, detail: detail}));
      }
    }
    customElements.define(FirebaseLoginout.is, FirebaseLoginout);
  </script>
</dom-module>