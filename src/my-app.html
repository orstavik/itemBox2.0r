<link rel="import" href="../bower_components/polymer/polymer.html">

<link rel="import" href="ui-plain.html">
<link rel="import" href="shape-plain.html">

<dom-module id="my-app">
  <template>
    <style>
      :host { height: 100%; }
    </style>

    <ui-plain on-change-shapes="_changeShapes"
              on-deselect-all="_deselect"
              on-new-box-selection="_select">
      <shape-plain id="shapePlain" shapes="[[shapes]]"></shape-plain>
    </ui-plain>

  </template>

  <script>

    class MatrixData {
      constructor(x, y, sx, sy, a) {
        this.x = x;
        this.sx = sx;
        this.sy = sy;
        this.y = y;
        this.a = a;
      }

      static random() {
        return new MatrixData(
          Math.random() * (window.innerWidth - 100) - window.innerWidth / 2 + 50,
          Math.random() * (window.innerHeight - 100) - window.innerHeight / 2 + 50,
          1,
          1,
          Math.random() * Math.PI * 2);
      }

      compute() {
        let matrix = [
          this.sx * Math.cos(this.a),
          this.sx * Math.sin(this.a),
          -this.sy * Math.sin(this.a),
          this.sy * Math.cos(this.a),
          this.x,
          this.y
        ];
        return "matrix(" + matrix.join(",") + ")";
      }

      clone(){
        return new MatrixData(this.x, this.y, this.sx, this.sy, this.a);
      }
    }

    class MyApp extends Polymer.Element {
      static get is() {
        return "my-app";
      }

      static get properties() {
        return {
          shapes: {
            type: Object,
            value: function () {
              const res = {};
              for (let i = 0; i < 10; i++)
                res["shape" + i] = MatrixData.random();
              return res;
            }
          }
        }
      }

      _changeShapes(e) {
        this.$.shapePlain.changeShapes(e.detail);
        //change the state shapes object array instead
      }

      _deselect() {
        this.$.shapePlain.deselect();
      }

      _select(e) {
        this.$.shapePlain.boxSelect(e.detail);
      }
    }
    customElements.define(MyApp.is, MyApp);
  </script>
</dom-module>